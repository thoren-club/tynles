# Настройка переменных окружения

Этот файл содержит подробные инструкции по настройке переменных окружения для проекта.

## Быстрый старт

1. Скопируйте файл `.env.example` в `.env`:
   ```bash
   cp .env.example .env
   ```
   
   Или создайте файл `.env` вручную в корне проекта.

2. Откройте файл `.env` и заполните необходимые переменные.

## Обязательные переменные

### BOT_TOKEN
Токен вашего Telegram бота, полученный от [@BotFather](https://t.me/BotFather).

**Как получить:**
1. Откройте [@BotFather](https://t.me/BotFather) в Telegram
2. Отправьте команду `/newbot` или `/token`
3. Следуйте инструкциям для создания бота или получения токена
4. Скопируйте токен и вставьте в `.env`

**Пример:**
```env
BOT_TOKEN=1234567890:ABCdefGHIjklMNOpqrsTUVwxyz
```

### DATABASE_URL
Строка подключения к PostgreSQL базе данных.

**Формат:**
```
postgresql://username:password@host:port/database_name
```

**Примеры:**

Локальная база данных:
```env
DATABASE_URL=postgresql://postgres:password@localhost:5432/taskbot
```

База данных на удаленном сервере:
```env
DATABASE_URL=postgresql://user:pass@db.example.com:5432/taskbot
```

База данных с SSL (например, Supabase, Railway, Render):
```env
DATABASE_URL=postgresql://user:pass@host:5432/db?sslmode=require
```

**Как создать базу данных:**
- **Локально:** Установите PostgreSQL и создайте базу данных
- **Облачные сервисы:**
  - [Supabase](https://supabase.com) - бесплатный план доступен
  - [Railway](https://railway.app) - бесплатный план доступен
  - [Render](https://render.com) - бесплатный план доступен
  - [Neon](https://neon.tech) - бесплатный план доступен

## Опциональные переменные

### WEB_APP_URL
URL вашего Mini App. Используется для создания кнопки в боте.

**Для development:**
```env
WEB_APP_URL=http://localhost:5173
```
Или можно оставить значение по умолчанию `https://your-domain.com` - оно не будет использоваться в development.

**Для production:**
```env
WEB_APP_URL=https://your-domain.com
```

**Важно:** URL должен быть доступен по HTTPS в production. Telegram требует HTTPS для Mini Apps.

### PORT
Порт, на котором будет запущен веб-сервер (по умолчанию 3000).

```env
PORT=3000
```

### LOG_LEVEL
Уровень логирования (по умолчанию 'info').

Возможные значения:
- `error` - только ошибки
- `warn` - предупреждения и ошибки
- `info` - информационные сообщения, предупреждения и ошибки (рекомендуется)
- `debug` - подробная отладочная информация
- `trace` - максимально подробная информация

```env
LOG_LEVEL=info
```

### BOT_ONLY
Если установлено в `true`, веб-сервер не будет запускаться. Используйте это, если хотите запускать только бота.

```env
BOT_ONLY=false
```

## Пример полного файла .env

```env
# Обязательные
BOT_TOKEN=1234567890:ABCdefGHIjklMNOpqrsTUVwxyz
DATABASE_URL=postgresql://postgres:password@localhost:5432/taskbot

# Опциональные
WEB_APP_URL=https://your-domain.com
PORT=3000
LOG_LEVEL=info
BOT_ONLY=false
```

## Проверка настроек

После настройки переменных окружения, проверьте, что все работает:

1. **Проверьте синтаксис файла .env:**
   - Убедитесь, что нет пробелов вокруг знака `=`
   - Убедитесь, что значения не заключены в кавычки (если не требуется)
   - Убедитесь, что нет лишних пробелов в начале/конце значений

2. **Запустите бота:**
   ```bash
   npm run dev
   ```
   
   Если все настроено правильно, вы увидите сообщение "Bot started".

3. **Проверьте подключение к базе данных:**
   ```bash
   npm run db:studio
   ```
   
   Это откроет Prisma Studio, где вы сможете просмотреть данные в базе.

## Безопасность

⚠️ **Важно:**
- Никогда не коммитьте файл `.env` в Git (он уже в `.gitignore`)
- Не делитесь токеном бота и паролями от базы данных
- Используйте разные токены для development и production
- Регулярно обновляйте пароли и токены

## Troubleshooting

### Ошибка "BOT_TOKEN is required"
- Убедитесь, что файл `.env` существует в корне проекта
- Проверьте, что переменная `BOT_TOKEN` указана правильно
- Убедитесь, что нет пробелов вокруг знака `=`

### Ошибка "DATABASE_URL is required"
- Убедитесь, что переменная `DATABASE_URL` указана правильно
- Проверьте формат строки подключения
- Убедитесь, что база данных доступна

### Ошибка подключения к базе данных
- Проверьте, что PostgreSQL запущен (для локальной БД)
- Проверьте правильность username, password, host и port
- Проверьте, что база данных существует
- Для облачных сервисов проверьте настройки firewall и SSL

### Mini App не открывается
- Убедитесь, что `WEB_APP_URL` указан правильно
- Проверьте, что URL доступен по HTTPS (для production)
- Убедитесь, что Mini App настроен в BotFather
